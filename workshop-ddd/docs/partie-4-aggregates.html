<!doctype html>
<html lang="en">
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

		<title>reveal.js</title>

		<link rel="stylesheet" href="dist/reset.css">
		<link rel="stylesheet" href="dist/reveal.css">
		<link rel="stylesheet" href="dist/theme/moon.css">
		<link rel="stylesheet" href="css/customization.css">

		<!-- Theme used for syntax highlighted code -->
		<link rel="stylesheet" href="plugin/highlight/monokai.css">
	</head>
	<body>
		<div class="reveal">
			<div class="slides">
				<section>
					<h1>Domain-Driven Design</h1>

					<aside data-markdown class="notes">

					</aside>
				</section>
				<section>
					<h1>PATTERNS TACTIQUES</h1>
				</section>
				<section>
					<h1>AGGREGATES</h1>
				</section>
				<section>
					<h2>Exercice pratique</h2>
					<aside data-markdown class="notes">
						Exercice d'introduction
						C'est juste un exercice d'intro qui servira pour les exercices d'après

						Consignes : 
						- Créer un graphe d'objet correspondant au brief sur la gauche
						- pas d'obligations de mettre des indications sur les flèches
						- il n'y a pas de piège
						- Durée : 5-10 minutes

						A la fin de l'exo :
						- si on a du mal à faire un "beau" graphe objet, c'est peut être qu'il y a un problème
						- Que peut-on dire de ce graphe d'objets ? => il est "costaud", gros 
						- Et encore, on s'est arrété à ce brief là, qui pourrait être bcp plus complet
						- si on transforme ce graphe en MPD, qu'est-ce que ça implique de récupérer un Journey ? Et qu'est-ce qu'on voulait récupérer comme information, ou faire à la base ?
						- Comment fait-on en SQL pour charger tout l'objet Journey ? => une grosse jointure SQL => Bravo, tu viens de charger toute ta base
						- Autre solution, utiliser le lazy loading, et le configurer par contexte pour ne pas tout charger. Inconvénient => on peut se retrouver avec des NullRef
						- On ne peut pas partir de ce graphe pour modéliser le comportement de l'application
						- Le graphe d'objet doit venir en complément de l'ES par exemple
						  - l'event storming permet de détailler les intéractions
						  - le graphe d'objet permet de spécifier un peu les data

					</aside>
				</section>
				<section>
					<h5>Responsabilité</h5>
					<p>
						Protège les <span class="highlight">invariants</span> d’un ensemble d’objets
					</p>
				</section>
				<section>
					<h5>Responsabilité</h5>
					<p>
						Délimite la concurrence du système
					</p>
				</section>
				<section>
					<img class="r-frame" src="./img/part4/bank-account.png" />
					<aside data-markdown class="notes">
						Exemple : un compte bancaire
						- On veut retirer de l'argent de ce compte bancaire => 100€
						- Et on a une règle, ne pas être à découvert => donc si j'ai 100€, ça passe
						- on voit ici qu'on a 
						  - une frontière (qui s'appelle le compte bancaire)
						  - des actions possibles (appelée stimulus)
						- ce stiumulus (retirer de l'argent) va executer des règles métier et va faire en sorte que quelque soit le stimulus que tu vas envoyer, l'état du compte bancaire soit toujours consistant avec les règles du compte bancaire
						- Dans notre cas, il fera en sortie qu'on ait toujours un minimum de 0€ sur le compte
						- invariant = quelque chose qui ne varie pas => quelque chose qui doit toujours être vrai, quelque soit les circonstances. C'est une règle extrêmement rigide. (ex : une quantité ne peut être inférieure à 0).
						- les invariants sont des règles métiers (mais les règles métier ne sont pas toutes des invariants)
						- invariant  = notion fondamentale en DDD => car ils vont guider le design de notre système
					</aside>
				</section>
				<section>
					<img class="r-frame" src="./img/part4/bank-account-withdrawal.png" />
					<aside data-markdown class="notes">
						Exemple : un compte bancaire
						- Alice et Bob veulent retirer de l'argent, qu'est-ce qui peut mal se passer ? Que la somme des deux retraits dépasse le solde du compte
						- Comment éviter que ça arrive ? (solution, tu en tue un des deux :p ) => un système de sémaphore (ou autrement dit un lock)
						- C'est à dire que le compte en banque va limiter son usage à une seule personne à la fois (pour contrecarrer le risque de violer l'invariant)
						- Donc premier problème : lorsqu'on a des invariants, on est obligé de limiter la concurence dans notre système
					</aside>
				</section>
				<section>
					<img class="r-frame" src="./img/part4/concert-buy-ticket.png" />
					<aside data-markdown class="notes">
						Autre exemple : un système de réservation de place de concert (ou de train)
						On va voir que selon le contexte, selon le besoin (toujours drivé par le métier), parfois on va vouloir remettre en question un invariant
						- exemple : est-ce que c'est vraiment un invariant ? Est-ce qu'on ne peut pas vraiment acheter plus de tickets que disponible ? Que se passe-t-il si cela arrive ?
						- est-ce qu'on peut faire de la survente ? (comme dans les billets d'avions, ou de train)
						- un invariant est là pour bloquer la concurence d'un système. Mais que lorsque le besoin est d'avoir de la concurrence (ex : fort traffic), il faut éventuellement RELAXER ces invariants

						Un aggregate est un pattern qui est intéressant ponctuellement, lorsqu'on a des invariants
						=> si tu peux relaxer ton invariant, tu peux modéliser ton système autrement
					</aside>
				</section>
				<section>Gardez vos Aggregates aussi <span class="highlight">petit que nécessaire</span></section>
				<section>
					Gros Aggregate = <span class="highlight">Faible Concurrence</span>
					<aside data-markdown class="notes">
						En effet, si tu charges un aggregate, tu met un lock dessus, et surtout TOUS les objets en dessous !

						Mettre le faible concurrence en ROUGE !
					</aside>
				</section>
				<section>
					<img class="r-frame" src="./img/part4/objects.png" />
					<aside data-markdown class="notes">
						Est-ce normal qu'on ne puisse pas me rembourser de l'argent pendant que je suis en train de faire un paiement ?
						Donc la consistence du système va avoir un impact direct sur la façon dont on va modéliser nos aggregates (et donc notre système)
					</aside>
				</section>
				<section>
					<h5>Responsabilité</h5>
					<p>
						Le design est guidé par les <span class="highlight">UseCases</span> et les <span class="highlight">Invariants</span>						
					</p>
				</section>				
				<section>
					<h2>Démonstration</h2>
					<aside data-markdown class="notes">
						Fin du cours 1 (1ère session sur les Aggregates)
						Time code : 1h50
						=> discussion intéressantes à reprendre dans le cours sur le TDD (et peut être l'event storming)
					</aside>
				</section>
				<section>
					<h2>Exercice pratique</h2>
					<aside data-markdown class="notes">
						Time code : 2h02
						Consignes : 
						- On a les usecases, les règles métier, et la concurrence nécessaire
						- Créer les aggregates
						- On se concentre sur la délimitation
						- Durée : 20 minutes

						Correction : timecode 2h05 => solution 2h14

					</aside>
				</section>
				<section>
					<h1>REGLES DES AGGREGATES</h1>
				</section>
				<section>
					<h5>Règle 1</h5>
					<p>
						Designer vos Aggregates à partir de vos invariants
					</p>
				</section>
				<section>
					<h5>Règle 2</h5>
					<p>
						Garder les Aggregates aussi petit que nécessaire
					</p>
				</section>
				<section>
					<h5>Règle 3</h5>
					<p>
						Référencer les autres Aggregates uniquement par leur ID
					</p>
				</section>
				<section>
					<h1>DOMAIN EVENTS</h1>
				</section>
				<section>
					<h5>Responsabilité</h5>
					<p>
						Représente un évènement émis dans notre domaine
					</p>
				</section>
				<section>
					<h5>Responsabilité</h5>
					<p>
						Un fait immuable, quelque chose qui s’est produit
					</p>
				</section>
				<section>
					<h5>Responsabilité</h5>
					<p>
						Important dans le cadre du domaine
					</p>
				</section>
				<section>
					<h5>Responsabilité</h5>
					<p>
						Langage métier
					</p>
				</section>
				<section>
					<img class="r-frame" src="./img/part4/bank-account-event.png" />
				</section>
				<section>
					<img class="r-frame" src="./img/part4/bank-account-events.png" />
				</section>
				<section>
					<h2>Exercice pratique</h2>
				</section>
				<section>
					<h1>LA DERNIERE REGLE DES AGGREGATES</h1>
				</section>
				<section>
					<h5>Règle 4</h5>
					<p>
						Utiliser <span class="highlight">l’Eventual Consistency</span> pour mettre à jour d’autres Aggregates
					</p>
				</section>				
				<section><span class="highlight">Transactional Consistency</span> : tout est mis à jour dans une même transaction</section>
				<section><span class="highlight">Eventual Consistency</span> : certains Aggregates sont mis à jour ultérieurement</section>
				<section><span class="highlight">Eventual</span> ne signifie pas <span class="highlight">“éventuellement”</span></section>
				<section><span class="highlight"></span>Eventual</span> signifie <span class="highlight">“tôt ou tard”</span> ! On peut parler de consistence retardée ou à retardement</section>
				<section>
					<p>
						Dans 5ms…
					</p>
					<p class="fragment">
						100ms…
					</p>
					<p class="fragment">
						1 seconde…
					</p>
					<p class="fragment">
						1 minute…
					</p>
				</section>
				<section>
					<img class="r-frame" src="./img/part4/bank-account-eventual-consistency.png" />
				</section>
				<section>Est-ce grave si le compte bancaire reflète le dépôt <span class="highlight">après</span> avoir déposé les fonds ?</section>
				<section>
					<p>
						Dans 5ms…
					</p>
					<p class="fragment">
						100ms…
					</p>
					<p class="fragment">
						1 seconde…
					</p>
					<p class="fragment">
						1 minute…
					</p>
					<p class="fragment">
						1 jour !
					</p>
				</section>
				<section>
					<h2>Exercice pratique</h2>
				</section>
			</div>			
		</div>

		<script src="dist/reveal.js"></script>
		<script src="plugin/notes/notes.js"></script>
		<script src="plugin/markdown/markdown.js"></script>
		<script src="plugin/highlight/highlight.js"></script>
		<script>
			// More info about initialization & config:
			// - https://revealjs.com/initialization/
			// - https://revealjs.com/config/
			Reveal.initialize({
				hash: true,

				// Learn about plugins: https://revealjs.com/plugins/
				plugins: [ RevealMarkdown, RevealHighlight, RevealNotes ]
			});
		</script>
	</body>
</html>
